import { NextRequest, NextResponse } from 'next/server'

// –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ—Å—Ç–æ–π in-memory –∫—ç—à
const studentInfoCache = new Map<string, { data: any, timestamp: number }>();
const CACHE_DURATION = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç

export async function POST(req: NextRequest) {
  try {
    const { message, studentId } = await req.json()
    const lowerMessage = message.toLowerCase()
    
    console.log('ü§ñ Processing:', message)
    
    // –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã
    const quickResponse = getQuickResponse(lowerMessage)
    if (quickResponse) {
      return NextResponse.json({ response: quickResponse })
    }
    
    const studentInfo = await getStudentInfoCached(req)
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –≤–æ–ø—Ä–æ—Å–æ–≤
    if (isScheduleQuestion(lowerMessage)) {
      return await handleScheduleQuestion(message, studentInfo, req)
    }
    
    if (isPersonalInfoQuestion(lowerMessage)) {
      return await handlePersonalInfoQuestion(message, studentInfo)
    }
    
    // –î–û–ë–ê–í–õ–Ø–ï–ú: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ —Å–ø—Ä–∞–≤–∫–∞—Ö
    if (isDocumentsQuestion(lowerMessage)) {
      return await handleDocumentsQuestion(message, studentInfo)
    }
    
    return await handleGeneralQuestion(message, studentInfo)
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –≤ —á–∞—Ç API:', error)
    return NextResponse.json({ 
      error: '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞' 
    }, { status: 500 })
  }
}

// –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –±–µ–∑ API –≤—ã–∑–æ–≤–æ–≤
function getQuickResponse(message: string): string | null {
  const quickAnswers: Record<string, string> = {
    '–ø—Ä–∏–≤–µ—Ç': `üëã **–ü—Ä–∏–≤–µ—Ç!** –Ø Jolserik AI - —Ç–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–µ!

üéØ **–ú–æ–≥—É –ø–æ–º–æ—á—å —Å:**
‚Ä¢ üìÖ "–ú–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ" - –∑–∞–Ω—è—Ç–∏—è
‚Ä¢ üë§ "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å" - –ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è  
‚Ä¢ üè¢ "–ì–¥–µ –¥–µ–∫–∞–Ω–∞—Ç?" - –Ω–∞–≤–∏–≥–∞—Ü–∏—è
‚Ä¢ üìÑ "–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É?" - –¥–æ–∫—É–º–µ–Ω—Ç—ã

–ß—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç? üòä`,

    '—Å–ø–∞—Å–∏–±–æ': 'üòä –ü–æ–∂–∞–ª—É–π—Å—Ç–∞! –†–∞–¥ –ø–æ–º–æ—á—å! –ï—Å–ª–∏ –µ—Å—Ç—å –µ—â–µ –≤–æ–ø—Ä–æ—Å—ã - –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å!',
    '–ø–æ–∫–∞': 'üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è! –£–¥–∞—á–Ω–æ–≥–æ –¥–Ω—è –≤ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–µ!',
    
    // –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –ª–æ–∫–∞—Ü–∏–∏ —Å –ø—Ä—è–º—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏
    '—Ç–µ—Ö–Ω–æ–ø–∞—Ä–∫': `üè¢ **YU Technopark**

üìç **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:** 43.680864, 51.167732

üì± **–¢–µ–ª–µ—Ñ–æ–Ω (–∞–≤—Ç–æ–º–∞—Ä—à—Ä—É—Ç):** 
https://2gis.kz/aktau/directions/points/%7C51.167732%2C43.680864

üíª **–ö–æ–º–ø—å—é—Ç–µ—Ä (–æ—Ç–∫—Ä—ã—Ç—å –º–µ—Å—Ç–æ):** 
https://2gis.kz/aktau/geo/70000001097492813/51.167732,43.680864

üî¨ **–£—Å–ª—É–≥–∏:**
‚Ä¢ –°—Ç–∞—Ä—Ç–∞–ø-–∏–Ω–∫—É–±–∞—Ç–æ—Ä
‚Ä¢ IT-—Ü–µ–Ω—Ç—Ä –∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏
‚Ä¢ –ö–æ–≤–æ—Ä–∫–∏–Ω–≥ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

‚è∞ **–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:** –ü–Ω-–ü—Ç 9:00-18:00
üìû **–¢–µ–ª–µ—Ñ–æ–Ω:** +7 (7292) 40-03-01

üí° **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞:**
1. –ù–∞–∂–º–∏—Ç–µ –≤—Ç–æ—Ä—É—é —Å—Å—ã–ª–∫—É
2. –ù–∞ –∫–∞—Ä—Ç–µ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ú–∞—Ä—à—Ä—É—Ç"
3. –£–∫–∞–∂–∏—Ç–µ –æ—Ç–∫—É–¥–∞ –µ–¥–µ—Ç–µ`,

'—Å–ø–æ—Ä—Ç –∫–æ–º–ø–ª–µ–∫—Å': `üèãÔ∏è **–°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å**

üìç **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:** 43.685380, 51.165561

üì± **–¢–µ–ª–µ—Ñ–æ–Ω (–∞–≤—Ç–æ–º–∞—Ä—à—Ä—É—Ç):** 
https://2gis.kz/aktau/directions/points/%7C51.165561%2C43.685380

üíª **–ö–æ–º–ø—å—é—Ç–µ—Ä (–æ—Ç–∫—Ä—ã—Ç—å –º–µ—Å—Ç–æ):** 
https://2gis.kz/aktau/geo/70030076138753705/51.165561,43.685380

üèä **–£—Å–ª—É–≥–∏:**
‚Ä¢ –°–ø–æ—Ä—Ç–∑–∞–ª—ã –∏ –±–∞—Å—Å–µ–π–Ω
‚Ä¢ –¢—Ä–µ–Ω–∞–∂–µ—Ä–Ω—ã–π –∑–∞–ª
‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤!

‚è∞ **–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:** –ü–Ω-–ü—Ç 6:00-22:00, –°–±-–í—Å 8:00-20:00
üìû **–¢–µ–ª–µ—Ñ–æ–Ω:** +7 (7292) 40-04-01

üí° **–ù–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:** –í—Ç–æ—Ä–∞—è —Å—Å—ã–ª–∫–∞ ‚Üí –∫–Ω–æ–ø–∫–∞ "–ú–∞—Ä—à—Ä—É—Ç"`,

'–æ–±—â–µ–∂–∏—Ç–∏–µ 3': `üè† **–û–±—â–µ–∂–∏—Ç–∏–µ ‚Ññ3**

üìç **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:** 43.684928, 51.168348

üì± **–¢–µ–ª–µ—Ñ–æ–Ω (–∞–≤—Ç–æ–º–∞—Ä—à—Ä—É—Ç):** 
https://2gis.kz/aktau/directions/points/%7C51.168348%2C43.684928

üíª **–ö–æ–º–ø—å—é—Ç–µ—Ä (–æ—Ç–∫—Ä—ã—Ç—å –º–µ—Å—Ç–æ):** 
https://2gis.kz/aktau/geo/70000001028382451/51.168348,43.684928

üí∞ **–°—Ç–æ–∏–º–æ—Å—Ç—å:** 
‚Ä¢ 1-–º–µ—Å—Ç–Ω—ã–µ: 9000‚Ç∏/–º–µ—Å—è—Ü
‚Ä¢ 2-–º–µ—Å—Ç–Ω—ã–µ: 7000‚Ç∏/–º–µ—Å—è—Ü

üõèÔ∏è **–£–¥–æ–±—Å—Ç–≤–∞:** –∫—É—Ö–Ω–∏, –ø—Ä–∞—á–µ—á–Ω–∞—è, Wi-Fi
üìû **–ö–æ–º–µ–Ω–¥–∞–Ω—Ç:** +7 (7292) 40-02-04

üí° **–ù–∞ –ü–ö:** –í—Ç–æ—Ä–∞—è —Å—Å—ã–ª–∫–∞ ‚Üí "–ú–∞—Ä—à—Ä—É—Ç" ‚Üí —É–∫–∞–∂–∏—Ç–µ –æ—Ç–∫—É–¥–∞`,

'–æ–±—â–µ–∂–∏—Ç–∏–µ 4': `üè† **–û–±—â–µ–∂–∏—Ç–∏–µ ‚Ññ4 (–Ω–æ–≤–æ–µ)**

üìç **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:** 43.684070, 51.169297

üì± **–¢–µ–ª–µ—Ñ–æ–Ω (–∞–≤—Ç–æ–º–∞—Ä—à—Ä—É—Ç):** 
https://2gis.kz/aktau/directions/points/%7C51.169297%2C43.684070

üíª **–ö–æ–º–ø—å—é—Ç–µ—Ä (–æ—Ç–∫—Ä—ã—Ç—å –º–µ—Å—Ç–æ):** 
https://2gis.kz/aktau/geo/70000001081159673/51.169297,43.684070

üí∞ **–°—Ç–æ–∏–º–æ—Å—Ç—å:** 8500‚Ç∏/–º–µ—Å—è—Ü  
üÜï **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:** 
‚Ä¢ –ö—É—Ö–Ω–∏-—Å—Ç—É–¥–∏–∏
‚Ä¢ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞
‚Ä¢ –ö–∞—Ñ–µ –≤ –∑–¥–∞–Ω–∏–∏
‚Ä¢ –ú–µ–¥–ø—É–Ω–∫—Ç

üìû **–ö–æ–º–µ–Ω–¥–∞–Ω—Ç:** +7 (7292) 40-02-05

üí° **–ü–ö:** –í—Ç–æ—Ä–∞—è —Å—Å—ã–ª–∫–∞ ‚Üí –∫–Ω–æ–ø–∫–∞ "–ú–∞—Ä—à—Ä—É—Ç"`,

'–≥–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å': `üèõÔ∏è **Yessenov University (–≥–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å)**

üìç **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:** 43.681465, 51.168418

üì± **–¢–µ–ª–µ—Ñ–æ–Ω (–∞–≤—Ç–æ–º–∞—Ä—à—Ä—É—Ç):** 
https://2gis.kz/aktau/directions/points/%7C51.168418%2C43.681465

üíª **–ö–æ–º–ø—å—é—Ç–µ—Ä (–æ—Ç–∫—Ä—ã—Ç—å –º–µ—Å—Ç–æ):** 
https://2gis.kz/aktau/geo/70000001028382321/51.168418,43.681465

üè¢ **–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏:**
‚Ä¢ **2 —ç—Ç–∞–∂:** –î–µ–∫–∞–Ω–∞—Ç—ã –≤—Å–µ—Ö —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–æ–≤
‚Ä¢ **4 —ç—Ç–∞–∂:** –†–µ–∫—Ç–æ—Ä–∞—Ç –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è  
‚Ä¢ **1 —ç—Ç–∞–∂:** –°—Ç–æ–ª–æ–≤–∞—è –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞

‚è∞ **–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:** –ü–Ω-–ü—Ç 8:00-18:00
üìû **–°–ø—Ä–∞–≤–æ—á–Ω–∞—è:** +7 (7292) 40-01-00

üí° **–ù–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:** –í—Ç–æ—Ä–∞—è —Å—Å—ã–ª–∫–∞ ‚Üí "–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç"`
  };

  const lowerMessage = message.toLowerCase().trim()
  
  for (const [keyword, response] of Object.entries(quickAnswers)) {
    if (lowerMessage === keyword || lowerMessage.includes(keyword)) {
      if (quickAnswers[response]) {
        return quickAnswers[response];
      }
      return response;
    }
  }

  return null;
}

// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–∞
async function getStudentInfoCached(req: NextRequest) {
  const cacheKey = 'student_info';
  const cached = studentInfoCache.get(cacheKey);
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
  if (cached && (Date.now() - cached.timestamp) < CACHE_DURATION) {
    console.log('üì¶ Using cached student info');
    return cached.data;
  }
  
  // –ü–æ–ª—É—á–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
  try {
    const baseUrl = req.url.split('/jolserik')[0]
    const response = await fetch(`${baseUrl}/jolserik/student-info`, {
      method: 'GET',
      headers: {
        'Cookie': req.headers.get('cookie') || '',
        'Authorization': req.headers.get('authorization') || ''
      }
    })

    if (response.ok) {
      const data = await response.json()
      const studentInfo = {
        isAuthenticated: true,
        fullName: data.data?.fullName || '–°—Ç—É–¥–µ–Ω—Ç',
        firstName: data.data?.fullName?.split(' ')[0] || '–°—Ç—É–¥–µ–Ω—Ç',
        studentNumber: data.data?.studentNumber || '',
        email: data.data?.email || '',
        faculty: data.data?.faculty || '',
        course: data.data?.course || 1,
        group: data.data?.group || '',
        gpa: data.data?.gpa || 0
      }
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
      studentInfoCache.set(cacheKey, { data: studentInfo, timestamp: Date.now() });
      console.log('üíæ Student info cached');
      
      return studentInfo;
    }
  } catch (error) {
    console.log('‚ö†Ô∏è Failed to fetch student info:', error)
  }

  return {
    isAuthenticated: false,
    fullName: '–ì–æ—Å—Ç—å',
    firstName: '–ì–æ—Å—Ç—å'
  }
}

function isScheduleQuestion(message: string): boolean {
  const scheduleKeywords = [
    '—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ', '–ø–∞—Ä—ã', '–∑–∞–Ω—è—Ç–∏—è', '–ª–µ–∫—Ü–∏—è', '—Å–µ–º–∏–Ω–∞—Ä',
    '–∫–æ–≥–¥–∞', '–≤–æ —Å–∫–æ–ª—å–∫–æ', '–≥–¥–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç', '—Å–ª–µ–¥—É—é—â–∞—è –ø–∞—Ä–∞',
    '—Å–µ–≥–æ–¥–Ω—è', '–∑–∞–≤—Ç—Ä–∞', '–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–≤—Ç–æ—Ä–Ω–∏–∫', '—Å—Ä–µ–¥–∞', '—á–µ—Ç–≤–µ—Ä–≥', '–ø—è—Ç–Ω–∏—Ü–∞',
    '–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '—Ñ–∏–∑–∏–∫–∞', '—Ö–∏–º–∏—è', '–∏—Å—Ç–æ—Ä–∏—è', '—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è'
  ]
  
  return scheduleKeywords.some(keyword => message.includes(keyword))
}

function isPersonalInfoQuestion(message: string): boolean {
  const personalKeywords = [
    // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
    '–º–æ–µ –∏–º—è', '–∫–∞–∫ –º–µ–Ω—è –∑–æ–≤—É—Ç', '–º–æ–π –ø—Ä–æ—Ñ–∏–ª—å', '–º–æ—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
    '–º–æ–π –∫—É—Ä—Å', '–º–æ—è –≥—Ä—É–ø–ø–∞', '–º–æ–π gpa', '–º–æ—è —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å',
    '–∫—Ç–æ —è', '–º–æ–∏ –¥–∞–Ω–Ω—ã–µ', '—Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π –Ω–æ–º–µ—Ä',
    '–º–æ–π —Ñ–∞–∫—É–ª—å—Ç–µ—Ç', '–º–æ—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å',
    
    // –í–∞—Ä–∏–∞–Ω—Ç—ã —Å –æ–ø–µ—á–∞—Ç–∫–∞–º–∏ –∏ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è–º–∏
    '–º–æ–π –ø—Ä—Ñ–∏–ª—å', '–º–æ–π –ø—Ä–æ—Ñ–∏', '–ø—Ä–æ—Ñ–∏–ª—å', '–ø—Ä—Ñ–∏–ª—å',
    '–º–æ—è –∏–Ω—Ñ–∞—Ä–º–∞—Ü–∏—è', '–º–æ—è –∏–Ω—Ñ–æ', '–∏–Ω—Ñ–æ',
    '–º–æ–π –∫—É—Ä—Å—ç', '–∫—É—Ä—Å', '–∫—É—Ä—Å—ç',
    '—Ñ–∞–∫—É–ª—å—Ç–µ—Ç', '—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å', '–≥—Ä—É–ø–ø–∞',
    '–º–æ–∏ –¥–∞–Ω–Ω—ã', '–¥–∞–Ω–Ω—ã–µ',
    
    // –ö–æ—Ä–æ—Ç–∫–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
    '–ø—Ä–æ—Ñ–∏–ª—å', '–∏–Ω—Ñ–æ', '–¥–∞–Ω–Ω—ã–µ', '–∫—É—Ä—Å', '–≥—Ä—É–ø–ø–∞', '—Ñ–∞–∫—É–ª—å—Ç–µ—Ç'
  ]
  
  const lowerMessage = message.toLowerCase().trim()
  
  // –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ñ—Ä–∞–∑
  if (personalKeywords.includes(lowerMessage)) {
    return true
  }
  
  // –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Ñ—Ä–∞–∑
  return personalKeywords.some(keyword => lowerMessage.includes(keyword))
}

async function handleScheduleQuestion(message: string, studentInfo: any, req: NextRequest) {
  // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏
  return NextResponse.json({
    response: `üìÖ **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ, ${studentInfo.firstName}**

üîÑ –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:
‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Platonus: https://platonus.yu.edu.kz
‚Ä¢ –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –¥–µ–∫–∞–Ω–∞—Ç: +7 (7292) 40-01-01

üì± –¢–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å —É –æ–¥–Ω–æ–≥—Ä—É–ø–ø–Ω–∏–∫–æ–≤!`
  })
}

async function handlePersonalInfoQuestion(message: string, studentInfo: any) {
  if (!studentInfo.isAuthenticated) {
    return NextResponse.json({
      response: "üîê –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É"
    })
  }

  const lowerMessage = message.toLowerCase().trim()

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –ø—Ä–æ—Ñ–∏–ª–µ
  const profileVariants = ['–ø—Ä–æ—Ñ–∏–ª—å', '–ø—Ä—Ñ–∏–ª—å', '–ø—Ä–æ—Ñ–∏', '–∏–Ω—Ñ–æ', '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', '–¥–∞–Ω–Ω—ã–µ']
  const isProfileQuestion = profileVariants.some(variant => lowerMessage.includes(variant))

  const facultyVariants = ['—Ñ–∞–∫—É–ª—å—Ç–µ—Ç', '—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å']
  const isFacultyQuestion = facultyVariants.some(variant => lowerMessage.includes(variant))

  const courseVariants = ['–∫—É—Ä—Å', '–∫—É—Ä—Å—ç', '–≥—Ä—É–ø–ø–∞']
  const isCourseQuestion = courseVariants.some(variant => lowerMessage.includes(variant))

  const nameVariants = ['–∏–º—è', '–∑–æ–≤—É—Ç']
  const isNameQuestion = nameVariants.some(variant => lowerMessage.includes(variant))

  if (isNameQuestion) {
    return NextResponse.json({
      response: `üëã **–ü—Ä–∏–≤–µ—Ç, ${studentInfo.firstName}!**

üìã **–í–∞—à–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**
‚Ä¢ **–ü–æ–ª–Ω–æ–µ –∏–º—è:** ${studentInfo.fullName}
‚Ä¢ **–°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π –Ω–æ–º–µ—Ä:** ${studentInfo.studentNumber}

üòä –ü—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?`
    })
  }

  if (isFacultyQuestion) {
    return NextResponse.json({
      response: `üèõÔ∏è **–í–∞—à —Ñ–∞–∫—É–ª—å—Ç–µ—Ç:** ${studentInfo.faculty}

üéì **–ö—É—Ä—Å:** ${studentInfo.course} ‚Ä¢ **–ì—Ä—É–ø–ø–∞:** ${studentInfo.group}

üìû **–î–µ–∫–∞–Ω–∞—Ç:** +7 (7292) 40-01-01
üìç **–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ì–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å, 2 —ç—Ç–∞–∂`
    })
  }

  if (isCourseQuestion) {
    return NextResponse.json({
      response: `üéì **–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**

‚Ä¢ **–ö—É—Ä—Å:** ${studentInfo.course}
‚Ä¢ **–ì—Ä—É–ø–ø–∞:** ${studentInfo.group}
‚Ä¢ **–§–∞–∫—É–ª—å—Ç–µ—Ç:** ${studentInfo.faculty}
‚Ä¢ **–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª (GPA):** ${studentInfo.gpa}

üìö –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å —É—á–µ–±–Ω—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏, –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å!`
    })
  }

  // –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  return NextResponse.json({
    response: `üë§ **–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å:**

‚Ä¢ **–ò–º—è:** ${studentInfo.fullName}
‚Ä¢ **–°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π –Ω–æ–º–µ—Ä:** ${studentInfo.studentNumber}
‚Ä¢ **Email:** ${studentInfo.email}
‚Ä¢ **–ö—É—Ä—Å:** ${studentInfo.course}
‚Ä¢ **–ì—Ä—É–ø–ø–∞:** ${studentInfo.group}
‚Ä¢ **–§–∞–∫—É–ª—å—Ç–µ—Ç:** ${studentInfo.faculty}
‚Ä¢ **GPA:** ${studentInfo.gpa}

üí° **–ú–æ–≥—É –ø–æ–º–æ—á—å —Å:**
‚Ä¢ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∑–∞–Ω—è—Ç–∏–π
‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –¥–µ–∫–∞–Ω–∞—Ç–µ
‚Ä¢ –ù–∞–≤–∏–≥–∞—Ü–∏–µ–π –ø–æ –∫–∞–º–ø—É—Å—É
‚Ä¢ –ü–æ–ª—É—á–µ–Ω–∏–µ–º —Å–ø—Ä–∞–≤–æ–∫`
  })
}

async function handleGeneralQuestion(message: string, studentInfo: any) {
  const lowerMessage = message.toLowerCase()
  const greeting = studentInfo.isAuthenticated ? 
    `${studentInfo.firstName}` : 
    '–ì–æ—Å—Ç—å'

  // –û–±—â–∏–π –æ—Ç–≤–µ—Ç –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
  return NextResponse.json({
    response: `ü§î **–ù–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª, ${greeting}**

üìã **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–º—ã:**
‚Ä¢ üè¢ "–ì–¥–µ –¥–µ–∫–∞–Ω–∞—Ç?" - –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã
‚Ä¢ üçΩÔ∏è "–ì–¥–µ —Å—Ç–æ–ª–æ–≤–∞—è?" - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∏—Ç–∞–Ω–∏–∏
‚Ä¢ üìÑ "–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É?" - –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
‚Ä¢ üíª "–ü—Ä–æ–±–ª–µ–º—ã —Å Platonus" - IT-–ø–æ–¥–¥–µ—Ä–∂–∫–∞
‚Ä¢ üè† "–û–±—â–µ–∂–∏—Ç–∏–µ" - –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è

üìû **–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–º–æ—â–∏:**
‚Ä¢ –î–µ–∫–∞–Ω–∞—Ç: +7 (7292) 40-01-01
‚Ä¢ IT-–ø–æ–¥–¥–µ—Ä–∂–∫–∞: +7 (7292) 40-01-05

üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å!`
  })
}

// –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö
function isDocumentsQuestion(message: string): boolean {
  const documentsKeywords = [
    '—Å–ø—Ä–∞–≤–∫–∞', '—Å–ø—Ä–∞–≤–∫–∏', '—Å–ø—Ä–∞–≤–∫—É', '—Å–ø—Ä–∞–≤–æ–∫',
    '–¥–æ–∫—É–º–µ–Ω—Ç', '–¥–æ–∫—É–º–µ–Ω—Ç—ã', '–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤',
    '–∑–∞—è–≤–ª–µ–Ω–∏–µ', '–∑–∞—è–≤–ª–µ–Ω–∏—è', '–∑–∞—è–≤–∫—É',
    '–ø–æ–ª—É—á–µ–Ω–∏–µ', '–ø–æ–ª—É—á–∏—Ç—å', '–ø–æ–ª—É—á–µ–Ω–∏–µ–º',
    '–∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å', '–≥–¥–µ –ø–æ–ª—É—á–∏—Ç—å',
    '—Å—Ç–∞—Ç—É—Å', '–≥–æ—Ç–æ–≤–∞ –ª–∏',
    '–∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞', '—Å–ø—Ä–∞–≤–∫–∞ –æ–± –æ–±—É—á–µ–Ω–∏–∏',
    '—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç', '–≤—ã–ø–∏—Å–∫–∞'
  ]
  
  const lowerMessage = message.toLowerCase()
  return documentsKeywords.some(keyword => lowerMessage.includes(keyword))
}

// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö
async function handleDocumentsQuestion(message: string, studentInfo: any) {
  const lowerMessage = message.toLowerCase()
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Å–ø—Ä–∞–≤–∫–∏
  if (lowerMessage.includes('–∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è') || lowerMessage.includes('—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç')) {
    return NextResponse.json({
      response: `üìÑ **–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞ (—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç)**

üìã **–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø–æ–ª—É—á–µ–Ω–∏—è:**
1. –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ —É—á–µ–±–Ω—É—é —á–∞—Å—Ç—å —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∑–∞—è–≤–ª–µ–Ω–∏–µ –Ω–∞ –≤—ã–¥–∞—á—É —Å–ø—Ä–∞–≤–∫–∏
3. –û–ø–ª–∞—Ç–∏—Ç—å –≥–æ—Å–ø–æ—à–ª–∏–Ω—É 1000 —Ç–µ–Ω–≥–µ
4. –ü–æ–ª—É—á–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É —á–µ—Ä–µ–∑ 5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π

üìë **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:**
‚Ä¢ –ü–∞—Å–ø–æ—Ä—Ç (–æ—Ä–∏–≥–∏–Ω–∞–ª)
‚Ä¢ –°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π –±–∏–ª–µ—Ç
‚Ä¢ –ö–≤–∏—Ç–∞–Ω—Ü–∏—è –æ–± –æ–ø–ª–∞—Ç–µ

üí∞ **–°—Ç–æ–∏–º–æ—Å—Ç—å:** 1000 —Ç–µ–Ω–≥–µ
‚è±Ô∏è **–°—Ä–æ–∫:** 5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π

üìû **–£—á–µ–±–Ω–∞—è —á–∞—Å—Ç—å:** +7 (7292) 40-01-03`
    })
  }
  
  if (lowerMessage.includes('—Å–ø—Ä–∞–≤–∫–∞ –æ–± –æ–±—É—á–µ–Ω–∏–∏') || lowerMessage.includes('—Å–ø—Ä–∞–≤–∫–∞ –æ')) {
    return NextResponse.json({
      response: `üìÑ **–°–ø—Ä–∞–≤–∫–∞ –æ–± –æ–±—É—á–µ–Ω–∏–∏**

üìã **–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø–æ–ª—É—á–µ–Ω–∏—è:**
1. –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –¥–µ–∫–∞–Ω–∞—Ç —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∑–∞—è–≤–ª–µ–Ω–∏–µ –Ω–∞ –≤—ã–¥–∞—á—É —Å–ø—Ä–∞–≤–∫–∏
3. –û–ø–ª–∞—Ç–∏—Ç—å –≥–æ—Å–ø–æ—à–ª–∏–Ω—É 500 —Ç–µ–Ω–≥–µ
4. –ü–æ–ª—É—á–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É —á–µ—Ä–µ–∑ 3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è

üìë **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:**
‚Ä¢ –ü–∞—Å–ø–æ—Ä—Ç (–æ—Ä–∏–≥–∏–Ω–∞–ª)
‚Ä¢ –°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π –±–∏–ª–µ—Ç
‚Ä¢ –ö–≤–∏—Ç–∞–Ω—Ü–∏—è –æ–± –æ–ø–ª–∞—Ç–µ

üí∞ **–°—Ç–æ–∏–º–æ—Å—Ç—å:** 500 —Ç–µ–Ω–≥–µ
‚è±Ô∏è **–°—Ä–æ–∫:** 3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è

üìû **–î–µ–∫–∞–Ω–∞—Ç:** +7 (7292) 40-01-01
üìç **–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ì–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å, 2 —ç—Ç–∞–∂, –∫–∞–±. 201-205`
    })
  }
  
  // –û–±—â–∏–π –æ—Ç–≤–µ—Ç –æ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø—Ä–∞–≤–æ–∫
  return NextResponse.json({
    response: `üìÑ **–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ–∫ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**

üìã **–û—Å–Ω–æ–≤–Ω—ã–µ –≤–∏–¥—ã —Å–ø—Ä–∞–≤–æ–∫:**

üîπ **–°–ø—Ä–∞–≤–∫–∞ –æ–± –æ–±—É—á–µ–Ω–∏–∏**
‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å: 500 —Ç–µ–Ω–≥–µ
‚Ä¢ –°—Ä–æ–∫: 3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è
‚Ä¢ –ì–¥–µ: –î–µ–∫–∞–Ω–∞—Ç (–∫–∞–±. 201-205)

üîπ **–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞ (—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç)**
‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å: 1000 —Ç–µ–Ω–≥–µ  
‚Ä¢ –°—Ä–æ–∫: 5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π
‚Ä¢ –ì–¥–µ: –£—á–µ–±–Ω–∞—è —á–∞—Å—Ç—å

üîπ **–°–ø—Ä–∞–≤–∫–∞ –æ —Å—Ç–∏–ø–µ–Ω–¥–∏–∏**
‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
‚Ä¢ –°—Ä–æ–∫: 1 —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å
‚Ä¢ –ì–¥–µ: –°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π –æ—Ç–¥–µ–ª

üìë **–û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
‚Ä¢ –ü–∞—Å–ø–æ—Ä—Ç + —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π –±–∏–ª–µ—Ç
‚Ä¢ –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ –∑–∞—è–≤–ª–µ–Ω–∏–µ
‚Ä¢ –û–ø–ª–∞—Ç–∞ –≥–æ—Å–ø–æ—à–ª–∏–Ω—ã

üìû **–ö–æ–Ω—Ç–∞–∫—Ç—ã:**
‚Ä¢ –î–µ–∫–∞–Ω–∞—Ç: +7 (7292) 40-01-01
‚Ä¢ –£—á–µ–±–Ω–∞—è —á–∞—Å—Ç—å: +7 (7292) 40-01-03
‚Ä¢ –°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π –æ—Ç–¥–µ–ª: +7 (7292) 40-01-04

üí° –ö–∞–∫—É—é –∏–º–µ–Ω–Ω–æ —Å–ø—Ä–∞–≤–∫—É –≤–∞–º –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å?`
  })
}
